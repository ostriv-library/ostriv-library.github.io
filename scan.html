<!DOCTYPE html>
<html lang="ua" data-bs-theme="dark">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>–Ø–∫ –≤–∑—è—Ç–∏ –∫–Ω–∏–≥—É ‚Äì Ostriv Library PEI</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VZETC56QET"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-VZETC56QET');
	</script>
	<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
	<nav class="navbar navbar-expand-lg bg-body-tertiary">
		<div class="container-fluid">
			<a class="navbar-brand" href="index.html">Ostriv Library PEI üá∫üá¶üá®üá¶</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav  ms-auto mb-2 mb-lg-0">
					<li class="nav-item">
						<a class="nav-link" aria-current="page" href="https://ostriv-library.github.io/">–ö–Ω–∏–∂–∫–æ–≤–∞ –ø–æ–ª–∏—Ü—è</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active">–Ø–∫ –≤–∑—è—Ç–∏ –∫–Ω–∏–≥—É</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col mt-4">

				<h2 class="mb-4 text-center">–ë—ñ–±–ª—ñ–æ—Ç–µ—á–Ω–∏–π —Å–∫–∞–Ω–µ—Ä</h2>

<!-- üì¶ –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è -->
<div id="scannerInterface">

	<!-- –°–∫–∞–Ω–µ—Ä –∫–Ω–∏–≥–∏ -->
	<h5>–°–∫–∞–Ω—É–π—Ç–µ –∫–Ω–∏–≥—É:</h5>
	<div id="bookScanner" class="mb-4" style="max-width: 500px; margin: auto;"></div>

	<!-- –°–∫–∞–Ω–µ—Ä —á–∏—Ç–∞—á–∞ -->
	<div id="readerSection" class="mb-4" style="max-width: 500px; margin: auto; display: none;">
		<h5>–°–∫–∞–Ω—É–π—Ç–µ —á–∏—Ç–∞—á–∞:</h5>
		<div id="readerScanner" class="mb-3"></div>
		<button id="skipReaderBtn" class="btn btn-secondary">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>
	</div>
</div>

<!-- üßæ –†–µ–∑—É–ª—å—Ç–∞—Ç -->
<div id="responseSection" class="mt-4 d-none">
	<div id="responseOutput" class="border rounded p-4 bg-white shadow-sm text-center fs-5">
		–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...
	</div>
	<div class="text-center mt-3">
		<button id="restartBtn" class="btn btn-primary">–ù–æ–≤–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è</button>
	</div>
</div>


</div>
</div>
</div>
</div>
<hr class="mt-4">
<footer class="container-fluid">
	<p class="float-end">
		<a href="#" title="–ù–∞–≤–µ—Ä—Ö"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-up-circle" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-7.5 3.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707z"/></svg></a>
	</p>
	<p>¬© 2025, –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –Ω–∞ PEI. <br><span class="small text-body-secondary">–î–∏–∑–∞–π–Ω —Ç–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ <a href="https://burdyga.design/" target="_blank">Burdyga.Design</a></span></p>
</footer>
<script>
  const bookScannerId = "bookScanner";
  const readerScannerId = "readerScanner";
  const readerSection = document.getElementById("readerSection");
  const scannerInterface = document.getElementById("scannerInterface");
  const responseSection = document.getElementById("responseSection");
  const responseOutput = document.getElementById("responseOutput");
  const restartBtn = document.getElementById("restartBtn");
  const skipReaderBtn = document.getElementById("skipReaderBtn");

  let html5QrBook = null;
  let html5QrReader = null;

  let bookCode = null;
  let readerCode = null;
  let readerScannerStarted = false;

  function clearState() {
    bookCode = null;
    readerCode = null;
    readerScannerStarted = false;
    responseOutput.innerHTML = "";
    responseSection.classList.add("d-none");
    scannerInterface.style.display = "block";
    readerSection.style.display = "none";
    document.getElementById(bookScannerId).innerHTML = "";
    document.getElementById(readerScannerId).innerHTML = "";
  }

  function startBookScanner() {
    html5QrBook = new Html5Qrcode(bookScannerId);
    Html5Qrcode.getCameras().then(cameras => {
      if (!cameras || cameras.length === 0) {
        alert("–ö–∞–º–µ—Ä—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.");
        return;
      }
      html5QrBook.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: { width: 250, height: 250 } },
        decodedText => {
          html5QrBook.stop().then(() => html5QrBook.clear()).then(() => {
            document.getElementById(bookScannerId).innerHTML = "";
            bookCode = decodedText;
            startReaderScanner();
          });
        }
      );
    }).catch(err => {
      console.error("–ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏ (–∫–Ω–∏–≥–∞):", err);
    });
  }

  function startReaderScanner() {
    readerSection.style.display = "block";
    document.getElementById(readerScannerId).innerHTML = "";

    html5QrReader = new Html5Qrcode(readerScannerId);
    readerScannerStarted = false;

    Html5Qrcode.getCameras()
      .then(cameras => {
        if (!cameras || cameras.length === 0) {
          console.warn("–ö–∞–º–µ—Ä—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è —á–∏—Ç–∞—á–∞.");
          return;
        }

        return html5QrReader
          .start(
            { facingMode: "environment" },
            { fps: 10, qrbox: { width: 250, height: 250 } },
            decodedText => {
              html5QrReader
                .stop()
                .then(() => html5QrReader.clear())
                .then(() => {
                  document.getElementById(readerScannerId).innerHTML = "";
                  readerCode = decodedText;
                  showLoadingAndSendRequest();
                });
            }
          )
          .then(() => {
            readerScannerStarted = true;
          })
          .catch(err => {
            console.warn("–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É —Å–∫–∞–Ω–µ—Ä–∞ —á–∏—Ç–∞—á–∞:", err);
            readerScannerStarted = false;
          });
      })
      .catch(err => {
        console.warn("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä:", err);
        readerScannerStarted = false;
      });
  }

  function showLoadingAndSendRequest() {
    scannerInterface.style.display = "none";
    responseSection.classList.remove("d-none");
    responseOutput.innerHTML = "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...";
    sendRequest();
  }

  async function sendRequest() {
    const encodedBook = encodeURIComponent(bookCode || "");
    const encodedReader = encodeURIComponent(readerCode || "0");

    const url = `https://script.google.com/macros/s/AKfycbzd-N4y7CeNWsasOr0a7RXh9dd8iwPjUPubX0FXDufrMkuHCGtodLUel5RLc9G7W5zA/exec?book=${encodedBook}&reader=${encodedReader}`;

    try {
      const response = await fetch(url);
      const text = await response.text();
      responseOutput.innerHTML = text;
    } catch (error) {
      responseOutput.innerHTML = "–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.";
    }
  }

  restartBtn.addEventListener("click", () => {
    clearState();
    startBookScanner();
  });

  skipReaderBtn.addEventListener("click", () => {
    readerCode = "0";
    if (readerScannerStarted && html5QrReader) {
      html5QrReader.stop().then(() => html5QrReader.clear()).finally(() => {
        document.getElementById(readerScannerId).innerHTML = "";
        showLoadingAndSendRequest();
      });
    } else {
      document.getElementById(readerScannerId).innerHTML = "";
      showLoadingAndSendRequest();
    }
  });

  // –°—Ç–∞—Ä—Ç –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
  startBookScanner();
</script>
</body>
</html>